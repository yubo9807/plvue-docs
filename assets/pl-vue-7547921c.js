var Pe=Object.defineProperty;var Ae=(e,n,t)=>n in e?Pe(e,n,{enumerable:!0,configurable:!0,writable:!0,value:t}):e[n]=t;var a=(e,n,t)=>(Ae(e,typeof n!="symbol"?n+"":n,t),t),se=(e,n,t)=>{if(!n.has(e))throw TypeError("Cannot "+t)};var ce=(e,n,t)=>(se(e,n,"read from private field"),t?t.call(e):n.get(e)),ie=(e,n,t)=>{if(n.has(e))throw TypeError("Cannot add the same private member more than once");n instanceof WeakSet?n.add(e):n.set(e,t)},P=(e,n,t,r)=>(se(e,n,"write to private field"),r?r.call(e,t):n.set(e,t),t);function J(e){return Object.prototype.toString.call(e).slice(8,-1).toLowerCase()}function w(e){return["object","array"].includes(J(e))}function Fe(e,n){return Object.prototype.hasOwnProperty.call(e,n)}function X(e,n){if(w(e)&&w(n)){const t=Object.keys(e),r=Object.keys(n);if(t.length!==r.length)return!1;for(const o of t)if(!r.includes(o)||!X(e[o],n[o]))return!1;return!0}else return e===n}function ye(){return typeof window=="object"}function _(e){return J(e)==="object"}function K(e){return Array.isArray(e)}function U(e){return typeof e=="string"}function g(e){return typeof e=="function"}function b(e){Promise.resolve().then(e)}const E=function(){const e=new WeakMap,n=["null","weakset","weakmap"],t={set(r){const o=new Set;for(const s of r)o.add(E(s));return o},map(r){const o=new Map;for(const[s,c]of r.entries())o.set(s,E(c));return o}};return function(r){const o=J(r);if(typeof r!="object"||n.includes(o))return r;if(e.has(r))return e.get(r);if(t[o])return t[o](r);const s=K(r)?[]:{};Object.setPrototypeOf(s,Object.getPrototypeOf(r)),e.set(r,s),b(()=>{e.delete(r)});for(const c in r)s[c]=E(r[c]);return s}}();function Z(e,n){return Object.assign({},e,n)}function We(){return Number(Math.random().toString().slice(2)).toString(32)}function M(...e){console.warn(...e)}let j=null;const F=new WeakMap;function W(e){j=e,e(),j=null}function Ve(e){const n=F.get(e)||[],t=n.some(r=>j===r);j&&!t&&(n.push(j),F.set(e,n))}function ue(e){const n=F.get(e);n&&n.forEach((t,r)=>{t()===!0&&(n.splice(r,1),F.set(e,n))})}const De=new WeakMap,z=new WeakMap,V={RAW:Symbol("__v_raw"),IS_READONLY:Symbol("__v_isReadonly")};function q(e){if(!w(e)||Object.isFrozen(e))return M(`lue cannot be made reactive: ${e}`),e;if(De.get(e))return e;let n=null;return new Proxy(e,{get(t,r,o){if(r===V.RAW)return t;if(w(t[r]))return q(t[r]);const s=Reflect.get(t,r,o);return Ve(t),s},set(t,r,o,s){if(t[V.IS_READONLY])return!0;if(w(t[r])){const f=t[r],p=new Set;for(const d in o)p.add(d),this.set(f,d,o[d],s[r]);for(const d in f)p.has(d)||this.deleteProperty(f,d);return!0}if(Reflect.get(t,r,s)===o)return!0;const u=Reflect.set(t,r,o,s),i=z.get(t)||new Set;i.add(r);const l=i.size;return z.set(t,i),b(()=>{const f=Reflect.get(t,r,s);u&&f===o&&l===1&&ue(t),z.delete(t)}),u},deleteProperty(t,r){const o=Reflect.get(t,r);if(w(o)){for(const u in o)this.deleteProperty(o,u);return!0}const s=Fe(t,r),c=Reflect.deleteProperty(t,r);return n=r,b(()=>{s&&c&&o!==void 0&&r===n&&(ue(t),n=null)}),c}})}function Ie(e){return!!e[V.RAW]}function we(e){return Ie(e)?e[V.RAW]:e}function Te(e){const n=q({value:e});function t(){return n.value}function r(o){n.value=o}return[t,r]}const be="__v_isRef";var ot;class Be{constructor(n){a(this,ot,!0);a(this,"__v_isShallow",!1);a(this,"_rawValue");a(this,"_value");a(this,"getSignal");a(this,"setSignal");this._rawValue=n;const[t,r]=Te(n);this.getSignal=t,this.setSignal=r,this._value=t()}get value(){return this.getSignal()}set value(n){this.setSignal(n),this._rawValue=n}}ot=be;function Re(e=void 0){return new Be(e)}class Ke{constructor(n){a(this,"fn");this.fn=n}}var st;class le{constructor(n,t){a(this,"__v_isReadonly",!0);a(this,st,!0);a(this,"_cacheable",!0);a(this,"_dirty",!0);a(this,"computed");a(this,"_setter");this.computed=new Ke(n),this._setter=t}get value(){return this.computed.fn()}set value(n){this._setter?this._setter(n):M("Write operation failed: computed value is readonly")}}st=be;function it(e){return g(e)?new le(e):new le(e.get,e.set)}function Se(e,n,t={}){let r=!1;if(r)return;const o=e();t.immediate&&n(o,void 0);let s=E(o),c=!0;return W(()=>{if(r)return!0;const u=e();if(w(u)){t.deep&&!X(u,s)&&(n(u,s),s=E(u));return}if(c){c=!1;return}u!==s&&(n(u,s),s=u)}),()=>{r=!0}}function O(e){return["string","number"].includes(typeof e)&&e!==""}function Ue(e){return!/^on/.test(e)}function v(e){return _(e)&&(U(e.tag)||x(e.tag))}function m(e){return g(e)&&!x(e)}function ee(e){return[void 0,null,"",!0,!1].includes(e)}function N(e){return document.createTextNode(e)}function R(e,n,...t){const r={tag:e,attrs:n||{},children:t};return m(r.tag)&&r.children.length===0&&r.attrs.children&&(r.children=r.attrs.children),r}function L(e){return e.prototype._id}function $({children:e}){return e}const D=Symbol("Fragment");$.prototype[D]=D;function x(e){return g(e)&&e.prototype[D]===D}const I=new WeakMap;function Ee(e,n=[]){return e.forEach(t=>{_(t)&&(m(t.tag)?n.push({comp:t.tag,compId:L(t.tag),props:Z(t.attrs,{children:e})}):O(t.tag)&&Ee(t.children,n))}),n}function te(e,n=[]){const t=I.get(e)||[];return n.push(...t),t.forEach(r=>{const o=te(r.comp);n.push(...o)}),n}let ne=null;function qe(e){ne=e}let fe=null;function Le(e,n){ne=e,"ref"in n&&(n.ref.value=fe),fe=null}const ae=new Map;function he(e){const n=te(e).map(r=>r.compId);n.unshift(L(e));const t=[];n.forEach(r=>{const o=ae.get(r)||[];t.push(...o),ae.delete(r)}),t.forEach(r=>{r()})}const T=new Map;function $e(e){const n=L(ne),t=T.get(n)||[];t.some(o=>o===e)||(t.push(e),T.set(n,t))}function de(e){const n=te(e).map(r=>r.compId);n.unshift(L(e));const t=[];n.forEach(r=>{const o=T.get(r)||[];t.push(...o),T.delete(r)}),t.forEach(r=>{r()})}function C(e,n,t){if(U(e))return re(e,n,t);if(x(e))return k(t);if(m(e)){e=e,e.prototype._id=We(),qe(e);const r=Z(n,{children:t}),o=e(r);return Le(e,n),O(o)?N(o):(I.set(e,Ee(o.children)),C(o.tag,o.attrs,o.children))}}function re(e,n={},t=[""]){if(x(e))return C(e,n,t);const r=document.createElement(e);t.forEach(o=>{if(!ee(o)){if(O(o)){const s=N(o);s.nodeValue=o,r.appendChild(s);return}if(g(o)){const s=k([o]);r.appendChild(s);return}if(K(o)){const s=k(o);r.appendChild(s);return}if(v(o)){const s=re(o.tag,o.attrs,o.children);r.appendChild(s);return}if(_(o)&&m(o.tag)){const s=C(o.tag,o.attrs,o.children);r.appendChild(s);return}M(`render: 不支持 ${o} 值渲染`)}});for(const o in n){const s=n[o];s&&(r[o]=s,o==="ref"&&(s.value=r),g(s)&&Ue(o)&&W(()=>{r[o]=s()}))}if(n.style&&_(n.style))for(const o in n.style){const s=n.style[o];g(s)?W(()=>r.style[o]=s()):r.style[o]=s}return r}function k(e){const n=document.createDocumentFragment();return e.forEach(t=>{if(!ee(t)){if(O(t)){const r=N(t);r.nodeValue=t,n.appendChild(r);return}if(g(t)){He(n,t);return}if(K(t)){const r=k(t);n.appendChild(r);return}if(v(t)){const r=re(t.tag,t.attrs,t.children);n.appendChild(r);return}if(_(t)&&m(t.tag)){const r=C(t.tag,t.attrs,t.children);n.appendChild(r);return}M(`render: 不支持 ${t} 值渲染`)}}),n}function pe(e){if(O(e))return N(e);if(v(e)||_(e)&&m(e.tag))return C(e.tag,e.attrs,e.children)}function ze(e,n){let t=0,r=e.length-1;for(;t<=r;){var o=Math.ceil((t+r)/2);if(n===e[o].key)return o;n<e[o].key?r=o-1:n>e[o].key&&(t=o+1)}return-1}function He(e,n){let t=[],r=!0,o=null;const s=N("");e.appendChild(s),W(()=>{let c=n();if(c&&_(c)&&x(c.tag)){M("不支持响应式节点片段渲染");return}K(c)||(c=[c]),c=c.filter(i=>!ee(i));let u=0;for(;u<c.length;){let i=c[u];const l=ze(t,u);if(l>=0){if(X(i,t[l].tree)){u++;continue}const f=pe(i);if(!f){c.splice(l,1),u++;continue}const p=t[l].tree;if(m(p.tag)&&he(p.tag),t[l].node.parentElement.replaceChild(f,t[l].node),m(p.tag)){const d=p.tag;de(d),I.delete(d)}t[l].tree=i,t[l].node=f}else{const f=pe(i);if(!f){u++;continue}if(r)e.appendChild(f);else if(t.length===0)o??(o=s.parentElement),o.insertBefore(f,s.nextSibling);else{const p=t[t.length-1].node,d=p.nextSibling;p.parentElement.insertBefore(f,d)}t.push({key:u,tree:i,node:f})}u++}if(t.length>c.length){for(let i=c.length;i<t.length;i++){const l=t[i].tree;if(m(l.tag)&&he(l.tag),t[i].node.remove(),m(l.tag)){const f=l.tag;de(f),I.delete(f)}}t.splice(c.length,t.length-c.length)}r=!1})}const me=[];function Ye(){me.forEach(e=>{e()}),me.length=0}const Y=[];let _e=!1;function Qe(e){if(_e){b(e);return}Y.push(e)}function Ge(){Y.forEach(e=>{e()}),Y.length=0,_e=!0}function ut({tag:e,attrs:n,children:t}){const r=C(e,n,t);return Ye(),b(Ge),r}function Q(e){const n=new URL("http://0.0.0.0"+e),t=n.pathname,r=h.routes.find(o=>t.startsWith(o.path+"/")&&o.exact===!1);return{monitor:r?r.path:t,fullPath:n.href.replace(n.origin,""),path:t,query:Je(n.search),hash:n.hash}}function Ce(e){if(U(e))return e;e=e;const n=e.path;let t="";for(const s in e.query)t+=`&${s}=${e.query[s]}`;t=t?"?"+t:"";const r=e.hash?"#"+e.hash:"";return n+t+r}const Je=function(){const e=/([^?&=]+)=([^&]+)/g;return n=>{const t={};return n.replace(e,(r,o,s)=>t[o]=s),t}}();function je(){return h.mode==="history"?location.href.replace(location.origin+h.base,""):location.hash.slice(1)}function ke(e){const{routes:n}=h,t=n.find(o=>o.path===e);if(t)return t;const r=n[n.length-1];if(r&&r.path===void 0&&r.component)return r}function Me(e,n){const t=Ce(e);oe(t).then(()=>{h.mode==="history"?history[n==="push"?"pushState":"replaceState"]({},"",h.base+t):location.hash=t})}function Oe(e){Me(e,"push")}function Ne(e){Me(e,"replace")}function A(e){history.go(e)}function Xe(){return{push:Oe,replace:Ne,go:A}}const h={base:"",mode:"history",ssrDataKey:"g_initialProps",routes:[]};let y=null;const xe=Re(!1);function lt(e={}){if(Object.assign(h,e),ye()){const n=Q(je());y=q(n),b(()=>{G(n,n,()=>{xe.value=!0})})}else y??(y=Q("/"));return{back:()=>A(-1),forward:()=>A(1),go:A,push:Oe,replace:Ne,options:h,currentRoute:we(y),beforeEach(n){G=n}}}let G=(e,n,t)=>{t()};function oe(e){const n=E(y),t=Q(e);return new Promise((r,o)=>{G(n,t,()=>{for(const s in t)y[s]=t[s];r(1)})})}function ft(){return y}function at(e){const n=[];e.children.forEach(o=>{o.tag==="title"?n.push(new RegExp("<title")):o.tag==="meta"&&o.attrs.name&&n.push(new RegExp(`<meta name=("|')?${o.attrs.name}`))});let t=[],r=0;return Qe(()=>{const o=document.head,s=o.innerHTML.split(`
`).filter(i=>i.includes("<")),c=[];e:for(let i=0;i<n.length;i++)for(let l=i;l<s.length;l++)if(n[i].test(s[l])){c.push(i);continue e}c.forEach(i=>{t.push(o.children[i].cloneNode(!0)),o.children[i].remove()}),r=e.children.length;const u=k(e.children);o.insertBefore(u,o.children[0])}),$e(()=>{const o=document.head;for(let s=0;s<r;s++)o.children[0].remove();t.forEach(s=>{o.insertBefore(s,o.childNodes[0])})}),R($,null)}let Ze,ge="/";function ve(){let e="";if(h.mode==="history")e=ge.replace(h.base,"");else{const t=ge.match(/#.*/);e=t?t[0]:""}oe(e);const n=ke(y.monitor);return R($,null,n&&R(n.component,{data:Ze}))}function et(e){window.addEventListener("popstate",()=>{oe(je())});const n=Re(null);let t;return Se(()=>y.monitor,async r=>{const o=ke(r);if(!o)return;const{getInitialProps:s}=o.component.prototype;if(g(s))if(window[h.ssrDataKey])t=window[h.ssrDataKey],delete window[h.ssrDataKey];else{n.value=e.loading;const c=we(y);t=await s(c)}n.value=o.component},{immediate:!0}),R($,null,()=>{const r=xe.value,o=n.value;return r&&o&&R(o,{data:t})})}function ht(e){return ye()?R(et,{...e}):R(ve,null)}const tt={to:"/",type:"push"};function dt(e){e=Z(tt,e);const n=U(e.to)?e.to:Ce(e.to),t=h.base+(h.mode==="hash"?"#"+n:n),r=Xe();function o(s){s.preventDefault(),e.type==="push"?r.push(n):r.replace(n)}return R("a",{className:e.className,href:t,onclick:o},e.children)}const B=Symbol("action");function nt(e){return g(e)&&e.prototype[B]===B}var S;class rt{constructor(n,t){a(this,"state");a(this,"actions");ie(this,S,!0);this.state=q(E(n)),this.actions={};for(const r in t){let s=function(...c){P(o,S,!1);const u=t[r](...c);if(w(u)&&u[Symbol.toStringTag]==="Promise")u.then(i=>(o._merge(n),b(()=>P(o,S,!0)),i));else return o._merge(n),b(()=>P(o,S,!0)),u};const o=this;s.prototype[B]=B,o.actions[r]=s}Object.assign(this.state,this.actions);for(const r in this.actions)Object.defineProperty(this.state,r,{writable:!1});Se(()=>this.state,()=>{ce(this,S)&&(console.error("Failed to update state."),this._merge(n))},{deep:!0})}_merge(n){const t=Object.keys(n);for(const r in n)this.state[r]=n[r];for(const r in this.state)nt(this.state[r])||!t.includes(r)&&delete this.state[r]}}S=new WeakMap;const H=new WeakMap;function pt(e,n){return()=>{if(!H.has(e)){const t=new rt(e,n);H.set(e,t.state)}return H.get(e)}}export{$ as F,at as H,dt as L,ht as R,it as a,lt as b,pt as c,ut as d,R as h,b as n,Qe as o,Re as r,ft as u,Se as w};

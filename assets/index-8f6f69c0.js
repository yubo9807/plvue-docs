"use strict";var R=Object.defineProperty;var S=(e,t,n)=>t in e?R(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n;var m=(e,t,n)=>(S(e,typeof t!="symbol"?t+"":t,n),n);Object.defineProperty(exports,Symbol.toStringTag,{value:"Module"});const u=require("pl-vue/lib/router"),s=require("pl-vue"),d=require("../server.js"),g=require("pl-vue/lib/utils"),T=require("axios-minified");require("http");require("fs");require("path");require("pl-vue/lib/store");const l=new Set,y=400;function $(e){const t=s.ref(!0),n=s.ref();let o=null;const r=Symbol("id");l.add(r);async function a(){if(t.value=!0,await I(y),l.delete(r),l.size===0)i.remove();else{const k=Number(n.value.dataset.sort),N=n.value.offsetHeight;n.value.remove(),[...i.children].forEach((h,v)=>{if(v<k)return;const P=parseInt(h.style.top);h.style.top=P-N-10+"px",h.dataset.sort=v+""})}}function p(){clearTimeout(o),t.value=!1}function C(){e.duration!==null&&(o=setTimeout(a,e.duration||4e3))}return s.h("div",{ref:n,className:()=>["comp-message",e.type,t.value&&"hidden"],"data-sort":l.size-1+"",style:`--time: ${y/1e3}s`,onmouseenter:p,onmouseout:C},e.message,s.h("span",{className:"icon-close",onclick:a},"×"))}let i=null;function c(e){if(!g.isBrowser())return;const t=d.app.render(s.h($,{...e}));i??(i=d.app.render(s.h("div",{className:"comp-message-wrap"}))),i.appendChild(t),document.body.appendChild(i)}c.info=e=>c({message:e,type:"info"});c.success=e=>c({message:e,type:"success"});c.error=e=>c({message:e,type:"error"});c.warning=e=>c({message:e,type:"warning"});c.closeAll=async()=>{!g.isBrowser()&&!i||([...i.children].forEach(e=>{e.classList.add("hidden"),e.remove()}),l.clear(),i.remove())};class E{constructor(t){m(this,"config");m(this,"instance");g.isBrowser()&&U(),this.config=t,this.instance=T.create(t),this.instance.interceptors.request.use(n=>this.requestUse(n)),this.instance.interceptors.response.use(n=>this.responseUse(n),n=>{const{response:o,config:r,message:a}=n;if(o&&o.data)return this.responseUse(o);const{url:p}=n.config;return Promise.reject({code:500,msg:a||"network error: "+p})})}requestUse(t){return t}responseUse(t){const n=t.data;return(this[n.code]||this.error)(t)}200(t){return Promise.resolve(t.data)}error(t){const{data:n,config:o}=t;return!o.noTips&&c.error(n.msg),Promise.reject(n)}}function L(e){return e.then(t=>[null,t]).catch(t=>[t,null])}function I(e){return new Promise(t=>{setTimeout(t,e)})}function U(){window.addEventListener("online",()=>{c.closeAll(),c.success("网络恢复")}),window.addEventListener("offline",()=>{c({type:"error",message:"网络中断",duration:null})})}class A extends E{constructor(){super({baseURL:d.env.BASE_API,timeout:5e3})}}const B=new A;function w(e){return L(B.instance(e))}function F(){return w({url:"/file/read",params:{path:"/plvue/config.json"}})}function j(e){return w({url:"/file/read",params:{path:e}})}const x="container-4ac8c9",M="side-f9a8bf",_="active-889810",D="content-a47edb",H="copy-e3443b",z="show-side-a60745",f={container:x,side:M,active:_,content:D,copy:H,"show-side":"show-side-a60745",showSide:z};function b(e){const t=s.ref(),n={title:e.data.config[e.path.split("/").pop()],description:""},o=e.data.content.match(/<p>(.+)<\/p>/);return o&&(n.description=o[1].replace(/<[^>]+>/g,"")),s.h("div",{ref:t,className:[f.content,"markdown"]},s.h(u.Helmet,null,s.h("title",null,()=>n.title+" | Pl Vue"),s.h("meta",{name:"description",content:()=>n.description})),s.h("section",{innerHTML:e.data.content}))}b.prototype.getInitialProps=async e=>{const t=e.path.replace("/docs/",""),[n,o]=await j(`/plvue/${t}.md`),r={config:exports.backupConfig,content:""};if(n)return r;const a=exports.backupConfig[t];return r.content=`<h1>${a}</h1>${o.data.content}`,r};exports.backupConfig=null;function q(e){exports.backupConfig=e.data;const t=[];for(const r in e.data)t.push({label:e.data[r],value:r});const n=s.ref(!1),o=s.ref(null);return s.ref(null),d.useStoreFixedBtns(),s.h("div",{className:["leayer",f.container]},s.h("ul",{ref:o,className:()=>[f.side,n.value&&f.active],onclick:()=>n.value=!1},t.map(r=>s.h("li",null,s.h(u.Link,{to:`${e.path}/${r.value}`},r.label)))),s.h(u.Router,{prefix:e.path,loading:d.Loading},s.h(u.Route,{path:"",redirect:e.path+"/"+t[0].value,component:()=>{}}),...t.map(r=>s.h(u.Route,{path:"/"+r.value,component:O(b)}))))}q.prototype.getInitialProps=async()=>{const[e,t]=await F();if(e)return{};const n=JSON.parse(t.data.content);return exports.backupConfig=n,n};function O(e){const t=function(...n){return e.apply(this,n)};return t.prototype=e.prototype,t}exports.default=q;

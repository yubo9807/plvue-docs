var _e=Object.defineProperty;var Ce=(e,n,t)=>n in e?_e(e,n,{enumerable:!0,configurable:!0,writable:!0,value:t}):e[n]=t;var d=(e,n,t)=>(Ce(e,typeof n!="symbol"?n+"":n,t),t);function z(e){return Object.prototype.toString.call(e).slice(8,-1).toLowerCase()}function b(e){return["object","array"].includes(z(e))}function je(e,n){return Object.prototype.hasOwnProperty.call(e,n)}function H(e,n){if(b(e)&&b(n)){const t=Object.keys(e),r=Object.keys(n);if(t.length!==r.length)return!1;for(const o of t)if(!r.includes(o)||!H(e[o],n[o]))return!1;return!0}else return e===n}function fe(){return typeof window=="object"}function R(e){return z(e)==="object"}function I(e){return Array.isArray(e)}function B(e){return typeof e=="string"}function y(e){return typeof e=="function"}function _(e){Promise.resolve().then(e)}const S=function(){const e=new WeakMap,n=["null","weakset","weakmap"],t={set(r){const o=new Set;for(const s of r)o.add(S(s));return o},map(r){const o=new Map;for(const[s,c]of r.entries())o.set(s,S(c));return o}};return function(r){const o=z(r);if(typeof r!="object"||n.includes(o))return r;if(e.has(r))return e.get(r);if(t[o])return t[o](r);const s=I(r)?[]:{};Object.setPrototypeOf(s,Object.getPrototypeOf(r)),e.set(r,s),_(()=>{e.delete(r)});for(const c in r)s[c]=S(r[c]);return s}}();function Y(e,n){return Object.assign({},e,n)}function Me(){return Number(Math.random().toString().slice(2)).toString(32)}function M(...e){console.warn(...e)}let C=null;const P=new WeakMap;function A(e){C=e,e(),C=null}function Ne(e){const n=P.get(e)||[],t=n.some(r=>C===r);C&&!t&&(n.push(C),P.set(e,n))}function te(e){const n=P.get(e);n&&n.forEach((t,r)=>{t()===!0&&(n.splice(r,1),P.set(e,n))})}const ke=new WeakMap,q=new WeakMap,F={RAW:Symbol("__v_raw"),IS_READONLY:Symbol("__v_isReadonly")};function Q(e){if(!b(e)||Object.isFrozen(e))return M(`lue cannot be made reactive: ${e}`),e;if(ke.get(e))return e;let n=null;return new Proxy(e,{get(t,r,o){if(r===F.RAW)return t;if(b(t[r]))return Q(t[r]);const s=Reflect.get(t,r,o);return Ne(t),s},set(t,r,o,s){if(t[F.IS_READONLY])return!0;if(b(t[r])){const f=t[r],p=new Set;for(const h in o)p.add(h),this.set(f,h,o[h],s[r]);for(const h in f)p.has(h)||this.deleteProperty(f,h);return!0}if(Reflect.get(t,r,s)===o)return!0;const i=Reflect.set(t,r,o,s),u=q.get(t)||new Set;u.add(r);const l=u.size;return q.set(t,u),_(()=>{const f=Reflect.get(t,r,s);i&&f===o&&l===1&&te(t),q.delete(t)}),i},deleteProperty(t,r){const o=Reflect.get(t,r);if(b(o)){for(const i in o)this.deleteProperty(o,i);return!0}const s=je(t,r),c=Reflect.deleteProperty(t,r);return n=r,_(()=>{s&&c&&o!==void 0&&r===n&&(te(t),n=null)}),c}})}function xe(e){return!!e[F.RAW]}function ae(e){return xe(e)?e[F.RAW]:e}function Oe(e){const n=Q({value:e});function t(){return n.value}function r(o){n.value=o}return[t,r]}const de="__v_isRef";var Ge;class Pe{constructor(n){d(this,Ge,!0);d(this,"__v_isShallow",!1);d(this,"_rawValue");d(this,"_value");d(this,"getSignal");d(this,"setSignal");this._rawValue=n;const[t,r]=Oe(n);this.getSignal=t,this.setSignal=r,this._value=t()}get value(){return this.getSignal()}set value(n){this.setSignal(n),this._rawValue=n}}Ge=de;function he(e=void 0){return new Pe(e)}class Ae{constructor(n){d(this,"fn");this.fn=n}}var Je;class ne{constructor(n,t){d(this,"__v_isReadonly",!0);d(this,Je,!0);d(this,"_cacheable",!0);d(this,"_dirty",!0);d(this,"computed");d(this,"_setter");this.computed=new Ae(n),this._setter=t}get value(){return this.computed.fn()}set value(n){this._setter?this._setter(n):M("Write operation failed: computed value is readonly")}}Je=de;function Ze(e){return y(e)?new ne(e):new ne(e.get,e.set)}function Fe(e,n,t={}){let r=!1;if(r)return;const o=e();t.immediate&&n(o,void 0);let s=S(o),c=!0;return A(()=>{if(r)return!0;const i=e();if(b(i)){t.deep&&!H(i,s)&&(n(i,s),s=S(i));return}if(c){c=!1;return}i!==s&&(n(i,s),s=i)}),()=>{r=!0}}function N(e){return["string","number"].includes(typeof e)&&e!==""}function Ve(e){return!/^on/.test(e)}function G(e){return R(e)&&(B(e.tag)||x(e.tag))}function m(e){return y(e)&&!x(e)}function J(e){return[void 0,null,"",!0,!1].includes(e)}function k(e){return document.createTextNode(e)}function w(e,n,...t){const r={tag:e,attrs:n||{},children:t};return m(r.tag)&&r.children.length===0&&r.attrs.children&&(r.children=r.attrs.children),r}function T(e){return e.prototype._id}function U({children:e}){return e}const V=Symbol("Fragment");U.prototype[V]=V;function x(e){return y(e)&&e.prototype[V]===V}const W=new WeakMap;function pe(e,n=[]){return e.forEach(t=>{R(t)&&(m(t.tag)?n.push({comp:t.tag,compId:T(t.tag),props:Y(t.attrs,{children:e})}):N(t.tag)&&pe(t.children,n))}),n}function X(e,n=[]){const t=W.get(e)||[];return n.push(...t),t.forEach(r=>{const o=X(r.comp);n.push(...o)}),n}let Z=null;function We(e){Z=e}let re=null;function De(e,n){Z=e,"ref"in n&&(n.ref.value=re),re=null}const oe=new Map;function se(e){const n=X(e).map(r=>r.compId);n.unshift(T(e));const t=[];n.forEach(r=>{const o=oe.get(r)||[];t.push(...o),oe.delete(r)}),t.forEach(r=>{r()})}const D=new Map;function Ie(e){const n=T(Z),t=D.get(n)||[];t.some(o=>o===e)||(t.push(e),D.set(n,t))}function ce(e){const n=X(e).map(r=>r.compId);n.unshift(T(e));const t=[];n.forEach(r=>{const o=D.get(r)||[];t.push(...o),D.delete(r)}),t.forEach(r=>{r()})}function E(e,n,t){if(B(e))return v(e,n,t);if(x(e))return j(t);if(m(e)){e=e,e.prototype._id=Me(),We(e);const r=Y(n,{children:t}),o=e(r);return De(e,n),N(o)?k(o):(W.set(e,pe(o.children)),E(o.tag,o.attrs,o.children))}}function v(e,n={},t=[""]){if(x(e))return E(e,n,t);const r=document.createElement(e);t.forEach(o=>{if(!J(o)){if(N(o)){const s=k(o);s.nodeValue=o,r.appendChild(s);return}if(y(o)){const s=j([o]);r.appendChild(s);return}if(I(o)){const s=j(o);r.appendChild(s);return}if(G(o)){const s=v(o.tag,o.attrs,o.children);r.appendChild(s);return}if(R(o)&&m(o.tag)){const s=E(o.tag,o.attrs,o.children);r.appendChild(s);return}M(`render: 不支持 ${o} 值渲染`)}});for(const o in n){const s=n[o];s&&(r[o]=s,o==="ref"&&(s.value=r),y(s)&&Ve(o)&&A(()=>{r[o]=s()}))}if(n.style&&R(n.style))for(const o in n.style){const s=n.style[o];y(s)?A(()=>r.style[o]=s()):r.style[o]=s}return r}function j(e){const n=document.createDocumentFragment();return e.forEach(t=>{if(!J(t)){if(N(t)){const r=k(t);r.nodeValue=t,n.appendChild(r);return}if(y(t)){Te(n,t);return}if(I(t)){const r=j(t);n.appendChild(r);return}if(G(t)){const r=v(t.tag,t.attrs,t.children);n.appendChild(r);return}if(R(t)&&m(t.tag)){const r=E(t.tag,t.attrs,t.children);n.appendChild(r);return}M(`render: 不支持 ${t} 值渲染`)}}),n}function ue(e){if(N(e))return k(e);if(G(e)||R(e)&&m(e.tag))return E(e.tag,e.attrs,e.children)}function Be(e,n){let t=0,r=e.length-1;for(;t<=r;){var o=Math.ceil((t+r)/2);if(n===e[o].key)return o;n<e[o].key?r=o-1:n>e[o].key&&(t=o+1)}return-1}function Te(e,n){let t=[],r=!0,o=null;const s=k("");e.appendChild(s),A(()=>{let c=n();if(c&&R(c)&&x(c.tag)){M("不支持响应式节点片段渲染");return}I(c)||(c=[c]),c=c.filter(u=>!J(u));let i=0;for(;i<c.length;){let u=c[i];const l=Be(t,i);if(l>=0){if(H(u,t[l].tree)){i++;continue}const f=ue(u);if(!f){c.splice(l,1),i++;continue}const p=t[l].tree;if(m(p.tag)&&se(p.tag),t[l].node.parentElement.replaceChild(f,t[l].node),m(p.tag)){const h=p.tag;ce(h),W.delete(h)}t[l].tree=u,t[l].node=f}else{const f=ue(u);if(!f){i++;continue}if(r)e.appendChild(f);else if(t.length===0)o??(o=s.parentElement),o.insertBefore(f,s.nextSibling);else{const p=t[t.length-1].node,h=p.nextSibling;p.parentElement.insertBefore(f,h)}t.push({key:i,tree:u,node:f})}i++}if(t.length>c.length){for(let u=c.length;u<t.length;u++){const l=t[u].tree;if(m(l.tag)&&se(l.tag),t[u].node.remove(),m(l.tag)){const f=l.tag;ce(f),W.delete(f)}}t.splice(c.length,t.length-c.length)}r=!1})}const ie=[];function Ue(){ie.forEach(e=>{e()}),ie.length=0}const K=[];let me=!1;function qe(e){if(me){_(e);return}K.push(e)}function Ke(){K.forEach(e=>{e()}),K.length=0,me=!0}function ve({tag:e,attrs:n,children:t}){const r=E(e,n,t);return Ue(),_(Ke),r}function L(e){const n=new URL("http://0.0.0.0"+e),t=n.pathname,r=a.routes.find(o=>t.startsWith(o.path+"/")&&o.exact===!1);return{monitor:r?r.path:t,fullPath:n.href.replace(n.origin,""),path:t,query:Le(n.search),hash:n.hash}}function ge(e){if(B(e))return e;e=e;const n=e.path;let t="";for(const s in e.query)t+=`&${s}=${e.query[s]}`;t=t?"?"+t:"";const r=e.hash?"#"+e.hash:"";return n+t+r}const Le=function(){const e=/([^?&=]+)=([^&]+)/g;return n=>{const t={};return n.replace(e,(r,o,s)=>t[o]=s),t}}();function ye(){return a.mode==="history"?location.href.replace(location.origin+a.base,""):location.hash.slice(1)}function we(e){const{routes:n}=a,t=n.find(o=>o.path===e);if(t)return t;const r=n[n.length-1];if(r&&r.path===void 0&&r.component)return r}function be(e,n){const t=ge(e);ee(t).then(()=>{a.mode==="history"?history[n==="push"?"pushState":"replaceState"]({},"",a.base+t):location.hash=t})}function Re(e){be(e,"push")}function Ee(e){be(e,"replace")}function O(e){history.go(e)}function $e(){return{push:Re,replace:Ee,go:O}}const a={base:"",mode:"history",ssrDataKey:"g_initialProps",routes:[]};let g=null;const Se=he(!1);function et(e={}){if(Object.assign(a,e),fe()){const n=L(ye());g=Q(n),_(()=>{$(n,n,()=>{Se.value=!0})})}else g??(g=L("/"));return{back:()=>O(-1),forward:()=>O(1),go:O,push:Re,replace:Ee,options:a,currentRoute:ae(g),beforeEach(n){$=n}}}let $=(e,n,t)=>{t()};function ee(e){const n=S(g),t=L(e);return new Promise((r,o)=>{$(n,t,()=>{for(const s in t)g[s]=t[s];r(1)})})}function tt(){return g}function nt(e){const n=[];e.children.forEach(o=>{o.tag==="title"?n.push(new RegExp("<title")):o.tag==="meta"&&o.attrs.name&&n.push(new RegExp(`<meta name=("|')?${o.attrs.name}`))});let t=[],r=0;return qe(()=>{const o=document.head,s=o.innerHTML.split(`
`).filter(u=>u.includes("<")),c=[];e:for(let u=0;u<n.length;u++)for(let l=u;l<s.length;l++)if(n[u].test(s[l])){c.push(u);continue e}c.forEach(u=>{t.push(o.children[u].cloneNode(!0)),o.children[u].remove()}),r=e.children.length;const i=j(e.children);o.insertBefore(i,o.children[0])}),Ie(()=>{const o=document.head;for(let s=0;s<r;s++)o.children[0].remove();t.forEach(s=>{o.insertBefore(s,o.childNodes[0])})}),w(U,null)}let ze,le="/";function He(){let e="";if(a.mode==="history")e=le.replace(a.base,"");else{const t=le.match(/#.*/);e=t?t[0]:""}ee(e);const n=we(g.monitor);return w(U,null,n&&w(n.component,{data:ze}))}function Ye(e){window.addEventListener("popstate",()=>{ee(ye())});const n=he(null);let t;return Fe(()=>g.monitor,async r=>{const o=we(r);if(!o)return;const{getInitialProps:s}=o.component.prototype;if(y(s))if(window[a.ssrDataKey])t=window[a.ssrDataKey],delete window[a.ssrDataKey];else{n.value=e.loading;const c=ae(g);t=await s(c)}n.value=o.component},{immediate:!0}),w(U,null,()=>{const r=Se.value,o=n.value;return r&&o&&w(o,{data:t})})}function rt(e){return fe()?w(Ye,{...e}):w(He,null)}const Qe={to:"/",type:"push"};function ot(e){e=Y(Qe,e);const n=B(e.to)?e.to:ge(e.to),t=a.base+(a.mode==="hash"?"#"+n:n),r=$e();function o(s){s.preventDefault(),e.type==="push"?r.push(n):r.replace(n)}return w("a",{className:e.className,href:t,onclick:o},e.children)}export{U as F,nt as H,ot as L,rt as R,et as a,ve as b,Ze as c,w as h,_ as n,qe as o,he as r,tt as u,Fe as w};
